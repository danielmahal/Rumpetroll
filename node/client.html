<!doctype html>

<html>
	<head>
		<meta charset="utf-8">
		<title>Rumpetroll! â€” Node WebSocket Test Client</title>
		<style type="text/css">
			#container {
				width: 500px;
			}
			
			#container {
				width: 100%;
			}
			
			#input, #output {
				width: 500px;
			}
			
			#output {
				height: 300px;
			}
			
			#connect-url {
				width: 200px;
			}
		</style>

		<script type="text/javascript">
			var $ = function(id) {
				return document.getElementById(id);
			}
			
			var pad = function(value) {
				return (value < 10 ? '0' : '') + value;
			}
		
			var log = function(message) {
				var now = new Date();
				$('output').value += [pad(now.getHours()), pad(now.getMinutes()), pad(now.getSeconds())].join(':') + ' ' + message + '\n';
			}
			
			var connection;
			
			var connect = function() {
				connection = new WebSocket($('connect-url').value);
				connection.onopen = function() {
					$('connect').value = 'Disconnect';
					$('input').disabled = false;
					$('send').disabled = false;
					
					log('Connected.');
				}

				connection.onclose = function() {
					$('connect').value = 'Connect';
					$('input').disabled = true;
					$('send').disabled = true;
					
					log('Disconnected.');
				}
				
				connection.onerror = function() {
					log('Error: ' + arguments);
				}
				
				connection.onmessage = function(event) {
					log('>> ' + event.data);
				}
			}
			
			var disconnect = function() {
				connection.close();
				connection = null;
			}
			
			var send = function() {
				var text = $('input').value;
				connection.send(text);
				
				log('<< ' + text);
				
				$('input').value = '';
				$('input').focus();
			}
		</script>
	</head>
	<body>
		<div id="container">
			<div id="controls">
				<input id="connect-url" value="ws://localhost:8180/" />
				<input id="connect" type="Button" value="Connect" onclick="(connection ? disconnect : connect)()" />
			</div>
			<textarea id="output"></textarea>
			<div id="input-controls">
				<input id="input" disabled="true" onkeyup='if (event.which == 13) {send()}' />
				<input id="send" type="button" disabled="true" value="Send" onclick='send()'>
			</div>
		</div>
	</body>
</html>

